
create database haovdim

use haovdim
drop table hovot
drop table haovdim

create table haovdim
(
prati nvarchar(30),
mishpacha nvarchar(30),
tikishi int,
doal nvarchar(30),
leda date,
machlaka int,
maskoret int
)

insert into haovdim values

('Noach','Bashevis',81,'smeier@gmail.com','1971-04-04',1,9123),
('Gabriel','Zangwill',205,'heine@optonline.net','1976-07-08',3,12409),
('Nathan','Mond',129,'seurat@me.com','1973-04-17',2,10395),
('Tomas','Blomstein',147,'sumdumass@live.com','1974-01-21',3,10872),
('Davin','Pirbright',93,'gslondon@comcast.net','1971-10-07',2,9441),
('Osnat','Zundel',337,'jhardin@comcast.net','1982-02-13',3,15907),
('Rut','Backer',325,'jrifkin@aol.com','1981-08-11',3,15589),
('Shlomit','Myers',307,'panolex@att.net','1980-11-05',3,15112),
('Riva','Katz',321,'devphil@verizon.net','1981-06-10',3,15483),
('Shelly','Gartner',249,'afeldspar@icloud.com','1978-05-21',3,13575),
('Benjamin','Spector',11,'bolow@msn.com','1968-04-14',1,7268),
('Noya','Shalick',279,'mfleming@hotmail.com','1979-08-29',3,14370),
('Gian','Rosen',185,'keiji@att.net','1975-09-02',3,11879),
('Irina','Straus',225,'bolow@sbcglobal.net','1977-05-14',3,12939),
('Yehoshua','Baeck',49,'kayvonf@verizon.net','1969-11-24',1,8275),
('Shilo','Rabbinowitz',115,'duchamp@mac.com','1976-02-04',3,12144),
('Avimelech','Wassermann',9,'bsikdar@hotmail.com','1968-03-14',1,7215),
('Orian','Bamberger',257,'skythe@aol.com','1978-09-22',3,13787),
('Elijah','Susser',181,'gerlo@outlook.com','1975-12-04',3,12038),
('Amir','Balsam',122,'maneesh@sbcglobal.net','1972-11-13',2,10130),
('Senen','Manis',124,'sassen@live.com','1976-01-04',3,12091),
('Giannes','Kantor',17,'aibrahim@mac.com','1968-07-16',1,7427),
('Michaela','Smashnova',259,'plover@outlook.com','1978-10-23',3,13840),
('Mal','Bayme',139,'william@me.com','1973-09-19',3,10660),
('Jeremy','Janner',59,'danneng@hotmail.com','1968-04-14',1,8540),
('Jader','Bezalel',85,'juliano@yahoo.ca','1971-06-05',1,9229),
('Natali','Shub',231,'wortmanj@aol.com','1977-08-15',3,13098),
('Gavi','Rosenthal',47,'telbij@icloud.com','1969-10-24',1,8222),
('Dovev','Levi',161,'pmint@att.net','1974-08-26',3,11243),
('Ela','Matusevitch',265,'smeier@msn.com','1979-01-24',3,13999),
('Rinat','Zeiman',275,'jacks@comcast.net','1979-06-28',3,14264),
('Noy','Shafiner',351,'matty@outlook.com','1982-09-18',3,16278),
('Michal','Lerner',289,'rnelson@yahoo.ca','1980-01-31',3,14635),
('Chavatzelet','Wolf',227,'godeke@att.net','1977-06-14',3,12992),
('Naomi','Liberman',347,'keiji@yahoo.ca','1982-07-18',3,16172),
('Irit','Kedar',261,'bradl@gmail.com','1978-11-23',3,13893),
('Oshra','rubin',295,'grinder@mac.com','1980-05-03',3,14794),
('Nimrod','Aronthal',167,'rain@ko@msn.com','1974-11-27',3,11402),
('Fanya','Cowen',369,'gfody@yahoo.com','1983-06-24',1,16755),
('Daniele','Gross',169,'mavilar@me.com','1974-12-28',3,11455),
('Yehoash','Levinson',23,'seano@comcast.net','1968-10-17',1,7586),
('Eden','Rocker',367,'mstrout@mac.com','1983-05-24',3,16702),
('Rina','Ophir',269,'drewf@icloud.com','1979-03-27',3,14105),
('Jori','Twersky',127,'dimensio@gmail.com','1973-03-17',2,10342),
('Yeshaya','Frankel',117,'airship@yahoo.com','1972-10-13',2,10077),
('Akub','Bloom',63,'maratb@sbcglobal.net','1970-06-29',1,8646),
('Uriel','Hart',51,'ideguy@aol.com','1969-12-25',1,8328),
('Shirli','Liberman',371,'jramio@me.com','1983-07-25',4,16808),
('Emuna','Ginsberg',303,'fwitness@yahoo.ca','1980-09-04',3,15006),
('Natanael','Luxemburg',133,'trygstad@hotmail.com','1973-06-18',2,10501),
('Rebecca','Backer',329,'satishr@yahoo.ca','1981-10-12',1,15695),
('Mika','Grunwald',255,'neonatus@yahoo.ca','1978-08-22',3,13734),
('Mathe','Goldman',35,'jacks@me.com','1969-04-21',1,7904),
('Yahel','Sarkin',209,'skythe@me.com','1976-09-08',3,12515),
('Michal','Goldschmidt',297,'harp@ko@outlook.com','1980-06-03',3,14847),
('Racheli','Barak',283,'dawnsong@comcast.net','1979-10-30',1,14476),
('Oranit','Trachtenberg',389,'geoffr@mac.com','1984-04-29',4,17285),
('Roni','Mowshowitch',319,'pthomsen@aol.com','1981-05-10',2,15430),
('Jussi','Mayer',121,'oster@yahoo.ca','1972-12-14',2,10183),
('Lilach','Shapiro',395,'jcholewa@live.com','1984-07-31',4,17444),
('Bracha','Sharett',267,'jtorkbob@live.com','1979-02-24',1,17052),
('Dasha','Duchan',361,'ubergeeb@hotmail.com','1983-02-20',1,16543),
('Chaim','Hodesmann',113,'bulletin@live.com','1972-08-12',2,9971),
('Cochava','Goldschmidt',317,'codex@comcast.net','1981-04-09',3,15377),
('Laban','Yedidyah',149,'epeeist@comcast.net','1974-02-21',3,10925),
('Amalia','Samuel',253,'aprakash@att.net','1978-07-22',2,13681),
('Arye','Smashnova',171,'bartak@sbcglobal.net','1975-01-28',3,11508),
('Zack','Lawson',3,'bmidd@me.com','1967-12-12',1,7056),
('Ronit','Ophir',233,'agapow@me.com','1977-09-15',3,13151),
('Ruma','Gottesman',237,'specprog@outlook.com','1977-11-16',3,13257),
('Adi','Zalkind',53,'ryanshaw@optonline.net','1970-01-25',1,8381),
('Makis','Novokovichi',177,'nichoj@gmail.com','1975-05-01',3,11667),
('Laban','Bruck',153,'satishr@yahoo.com','1974-04-24',3,11031),
('Ahuva','Jung',239,'speev@ko@yahoo.com','1977-12-17',2,13310),
('Habib','Lerner',163,'jacks@icloud.com','1974-09-26',2,11296),
('Chana','Malbim',243,'msroth@live.com','1978-02-17',3,16416),
('Mosheh','Loewe',27,'augusto@live.com','1968-12-18',1,19692),
('Akiva','Jung',55,'ivoibs@verizon.net','1970-02-25',1,8434),
('Evelyn','Rocker',91,'animats@hotmail.com','1971-09-06',2,19388),
('Orah','Hurwitz',311,'gilmoure@gmail.com','1981-01-06',2,15218),
('Yoav','Sayar',125,'sburke@yahoo.ca','1973-02-14',2,10289),
('Avigail','Adler',383,'jbuchana@gmail.com','1984-01-27',4,17126),
('Tamar','Aronthal',353,'dsowsy@mac.com','1982-10-19',3,16331),
('Moshe','Shiloh',183,'dogdude@mac.com','1975-08-02',3,11826),
('Yahel','Zeiman',263,'odlyz.ko@me.com','1978-12-24',3,13946),
('Inbar','Pomerantz',299,'bruck@verizon.net','1980-07-04',3,14900),
('Ruchama','Bach',211,'skajan@msn.com','1976-10-09',3,12568),
('Miriam','Demsky',377,'sekiya@outlook.com','1983-10-26',4,16967),
('Rachel','Marks',223,'froodian@aol.com','1977-04-13',3,12886),
('Aviel','Shimoni',159,'luebke@live.com','1974-07-26',3,11120),
('Dorit','Sarasohn',271,'boftx@att.net','1979-04-27',3,14158),
('Yael','Shub',309,'rogerspl@yahoo.ca','1980-12-06',3,15165),
('Giacomo','Kabotinsky',109,'fangorn@optonline.net','1972-06-11',2,19865),
('Asaph','Pick',87,'glenz@live.com','1971-07-06',2,9282),
('Nava','Kempinski',375,'mcnihil@optonline.net','1983-09-25',4,16914),
('Jeremie','Zoegell',21,'grossman@msn.com','1968-04-14',1,7480),
('Shoshi','Garbacz',349,'ajohnson@live.com','1982-08-18',2,16225),
('Lapidoth','Hurwitz',25,'dburrows@hotmail.com','1968-11-17',1,7639),
('Lavan','Wassermann',1,'itstatus@msn.com','1967-11-11',1,7003),
('Jonam','Shimshelewitz',145,'cmdrgravy@verizon.net','1973-12-21',3,10820),
('Zmira','Becker',399,'bonmots@verizon.net','1984-10-01',4,17550),
('Gabriel','Bruck',393,'nighthawk@me.com','1984-06-30',1,17391),
('Amir','Segal',77,'jyoliver@outlook.com','1971-02-01',1,19017),
('Joshua','Goldbloom',83,'brbarret@msn.com','1971-05-05',1,19176),
('Avner','Reiss',187,'ranasta@icloud.com','1975-10-03',3,12032),
('Rafi','Sieff',41,'iamcal@aol.com','1969-07-23',1,18063),
('Jehoichin','Sharansky',45,'wortmanj@live.com','1969-09-23',1,8169),
('Heber','Mannes',165,'osrin@verizon.net','1974-10-27',3,11349),
('Oshra','Beer',293,'papathan@comcast.net','1980-04-02',3,14741),
('Meirav','Sharot',241,'eegsa@live.com','1978-01-17',3,13363),
('Ofir','Pinero',215,'fatelk@gmail.com','1976-12-10',3,12674),
('Gal','Brenner',203,'eabrown@comcast.net','1976-06-07',3,12356),
('Ziva','Baum',363,'nighthawk@mac.com','1983-03-23',3,16596),
('Ravid','Goni',101,'osrin@outlook.com','1972-02-08',2,9653),
('Jamie','Litvinov',105,'dsugal@verizon.net','1972-04-10',2,9759),
('Inna','Somper',323,'muzzy@att.net','1981-07-11',3,15536),
('Sgula','Ran',229,'jdray@verizon.net','1977-07-15',3,13045),
('Dalit','Okin',285,'webinc@me.com','1979-11-30',3,14529),
('Avital','Lotner',359,'jbailie@live.com','1983-01-20',3,6490),
('Fruma','Emanuel',391,'corrada@comcast.net','1984-05-30',4,17338),
('Arie','Sklare',173,'wsnyder@sbcglobal.net','1975-02-28',3,11561),
('Nissim','Abramson',135,'bryanw@yahoo.ca','1973-07-19',2,10554),
('Chava','Shulman',291,'jbuchana@yahoo.com','1980-03-02',3,6688),
('Marina','Dresner',201,'calin@icloud.com','1976-05-07',3,12303),
('Ofra','Breuer',357,'bastian@outlook.com','1982-12-20',3,16437),
('Matityahu','Iskowitch',131,'sethbrown@aol.com','1973-05-18',2,10448),
('Abigail','Luxemburg',385,'wsnyder@optonline.net','1984-02-27',4,17179),
('Zared','Liberman',67,'roesch@optonline.net','1970-08-30',1,8752),
('Isaac','Wakstok',95,'singer@att.net','1971-11-07',2,9494),
('Eliezer','Heilbron',57,'duchamp@verizon.net','1970-03-28',1,8487),
('Shira','Mendel',273,'bwcarty@icloud.com','1979-05-28',3,14211),
('Einat','Spiegel',213,'iapetus@verizon.net','1976-11-09',3,12621),
('Schmuel','Cohen',137,'bancboy@sbcglobal.net','1973-08-19',3,10607),
('Noya','Shalit',341,'kobayasi@hotmail.com','1982-04-16',3,16013),
('Dovev','Gould',143,'sjava@@mac.com','1973-11-20',3,10766),
('Uri','Wolmark',287,'marcs@verizon.net','1976-03-06',3,12317),
('Yonni','Malbim',103,'aschmitz@optonline.net','1972-03-10',2,9706),
('Jered','Graetz',107,'temmink@gmail.com','1972-05-11',2,9812),
('Riki','Brenner',339,'kosact@mac.com','1982-03-16',3,15960),
('Sol','Woolf',39,'thomasj@outlook.com','1969-06-22',1,8010),
('Nili','Kabotinsky',277,'rgarton@live.com','1979-07-29',3,14317),
('Orah','Daiches',235,'lydia@aol.com','1977-10-16',3,13204),
('Dan','Helfgott',89,'eminence@outlook.com','1971-08-06',2,9335),
('Orli','Kalish',365,'frikazoyd@msn.com','1983-04-23',3,16649),
('Ian','Levine',189,'stevelim@sbcglobal.net','1975-11-03',3,12185),
('Shuki','Ascher',181,'csilvers@icloud.com','1975-07-02',3,11773),
('Riva','Shine',221,'staikos@live.com','1977-03-13',3,12833),
('Shmulik','Bayme',79,'jesse@att.net','1971-03-04',1,9070),
('Jeremi','Kantor',5,'houle@aol.com','1968-01-12',1,7109),
('Oded','Wigram',175,'yamla@live.com','1975-03-31',3,11614),
('Isabel','Maccoby',75,'zava@dsky@msn.com','1971-01-01',1,8964),
('Zachi','Halevi',65,'barlow@yahoo.ca','1970-07-30',1,8699),
('Noa','Munk',61,'rain@ko@hotmail.com','1970-05-29',1,8593),
('Orian','Gretz',333,'jrkorson@hotmail.com','1981-12-13',3,15801),
('Adina','Rothenstein',301,'spadkins@att.net','1980-08-04',3,14953),
('Zahava','Pick',315,'stellaau@optonline.net','1981-03-09',3,15324),
('Shuimon','Shub',71,'chance@me.com','1970-10-31',1,8858),
('Sonia','Sharansky',287,'eidac@att.net','1979-12-31',3,14582),
('Mirit','Zalkind',343,'zeller@outlook.com','1982-05-17',3,16066),
('Mikhail','Vinchevsky',15,'papathan@hotmail.com','1968-06-15',1,7374),
('Hadar','Reinharz',29,'gslondon@sbcglobal.net','1969-01-18',1,7745),
('Zahava','Metz',207,'goldberg@yahoo.com','1976-08-08',3,12462),
('Hodaya','Homa',335,'atmarks@optonline.net','1982-01-13',3,15854),
('Anna','Levitt',245,'muadip@verizon.net','1978-03-20',3,13469),
('Avishag','Chagall',155,'tattooman@verizon.net','1974-05-25',3,11084),
('Cheli','Sacher',387,'dwsauder@sbcglobal.net','1984-03-29',4,17232),
('Orah','Pollack',331,'smallpaul@verizon.net','1981-11-12',3,15748),
('Sara','Har-Zahav',313,'rohitm@msn.com','1981-02-06',3,17271),
('Jaffa','Emanuel',69,'skythe@att.net','1970-09-30',1,8805),
('Chaviv','Levy',31,'jandrese@mac.com','1969-02-18',1,7798),
('Meital','Fiedler',219,'mfburgo@me.com','1977-02-10',3,12780),
('Dikla','Beer',251,'kronvold@outlook.com','1978-06-21',2,13628),
('Josiah','Goulston',157,'frosal@aol.com','1974-06-25',3,11137),
('Yair','Zundel',281,'fairbank@aol.com','1979-09-29',3,14423),
('Levi','Kahn',179,'jyoliver@msn.com','1975-06-01',3,11720),
('Avi','Neumegen',13,'heckerman@yahoo.com','1968-05-15',1,7321),
('Liora','Mendenhall',397,'pakaste@comcast.net','1984-08-31',4,17497),
('Mali','Sternberg',99,'jimmichie@gmail.com','1972-01-08',2,9600),
('Eii','Schalit',21,'mhanoh@att.net','1968-09-16',1,7533),
('Tova','Rosenthal',111,'fraterk@me.com','1972-07-12',2,9918),
('Drora','Shahar',381,'kspiteri@yahoo.com','1983-12-27',4,17073),
('Ephraim','Angel',123,'epeeist@att.net','1973-01-14',2,10236),
('Yamit','Wirth',247,'wojciech@gmail.com','1978-04-20',1,13522),
('Eliyohu','Wolf',141,'jaarnial@mac.com','1973-10-20',1,10713),
('Matti','Duchan',134,'suresh@verizon.net','1976-04-06',3,12250),
('Nathanial','Endelman',116,'stern@yahoo.com','1972-09-12',2,10024),
('Miki','Sherman',217,'chaikin@aol.com','1977-01-10',3,12727),
('Zacharia','Sharot',43,'jaesenj@sbcglobal.net','1969-08-23',1,8116),
('Nitzanit','Hyamson',305,'pedwards@hotmail.com','1980-10-05',3,17059),
('Debbi','Itzik',7,'ninenine@att.net','1968-02-12',1,7162),
('Dorin','Spiro',379,'multiplx@icloud.com','1983-11-26',4,17020),
('Israela','Yoffey',355,'jcholewa@mac.com','1982-11-19',3,16384),
('Nimrod','Uki',151,'zeitlin@optonline.net','1974-03-24',3,10978),
('Tziona','Asher',373,'pthomsen@comcast.net','1983-08-25',2,16861),
('Benzion','Diamond',37,'seano@mac.com','1969-05-22',1,7957),
('Tzofia','Matusevitch',327,'treev@ko@gmail.com','1981-09-11',3,15642),
('Oded','Pekarsky',33,'fmtbebuck@live.com','1969-03-21',1,7851),
('Chagai','Landeshut',97,'nweaver@me.com','1971-12-08',2,9547),
('Yanis','Grossman',73,'schwaang@gmail.com','1970-12-01',1,8911),
('Yardena','Spiro',345,'geeber@comcast.net','1982-06-17',3,16119)
;

select * from haovdim
select * from haovdim where machlaka = 1
select * from haovdim where maskoret<10000 and maskoret>120000
select * from haovdim where maskoret < 11000 or maskoret > 120000
select * from haovdim select prati,doal from haovdim
select * from haovdim where doal like '%gmail.com'
select * from haovdim where machlaka = 1 order by mishpacha ASC
select * from haovdim order by machlaka,prati desc 
select top (3) max (maskoret) from haovdim
select distinct top (3) * from haovdim order by maskoret desc
select * from haovdim where maskoret>19000
select distinct machlaka from haovdim  where maskoret>19000
select distinct machlaka from haovdim
---16.1-------
create clustered index ix_h
on haovdim (machlaka asc, mishpacha asc)
select* from haovdim
------16.2------



--2.1
update haovdim 
set mishpacha = 'choen'
where prati = 'oshra' and mishpacha = 'rubin'
--2.2
select * from haovdim where maskoret<7500
update haovdim set maskoret=maskoret*1.1
where maskoret<7500
--2.3
alter table éhaovdim 
add bonus int
update haovdim
set bonus = 0

--2.3.1
update haovdim
set bonus = 50
where machlaka = 1

--2.3.2
alter table haovdim
drop coulmn bonus
select * from haovdim

--2.4
delete from haovdim where tikishi>390


--3.1
alter table haovdim
add 
siduri int identity(1,1) primary key

--3.2
alter table haovdim 
add check (maskoret>=8000);

--3.2.1
update haovdim set maskoret = 8000 where maskoret <8001

--3.2.2
update haovdim set maskoret = 3000 where tikishi>0

--3.3
alter table haovdim
add unique (tikishi);

--3.3.1
select * from haovdim where tikishi=21
update haovdim set tikishi = 22 where siduri=179
alter table haovdim
add unique (tikishi);
select * from haovdim where tikishi=181
update haovdim set tikishi = 182 where siduri=146
alter table haovdim
add unique (tikishi);
select * from haovdim where tikishi=287
update haovdim set tikishi = 288 where siduri=158
alter table haovdim
add unique (tikishi);

--3.3.2
update haovdim set tikishi = 287 where prati='Sonia'


--3.4
alter table haovdim
add bonus int check(bonus<6)
update haovdim set bonus=6 where tikishi>40 and tikishi<60

--4.1
select * from haovdim count where machlaka = 3

--4.2
select  sum(maskoret) from haovdim

select sum (maskoret)as "meutza ovdim" from haovdim

select avg (maskoret) as  "memutza ovdim" from haovdim

--4.3
select sum (maskoret) as "hotzhaot al 1" from haovdim group by machlaka
 
--4.4
select * from haovdim where tikishi >=200 and  tikishi <=300

--4.5
select machlaka, avg(maskoret) as AvgMskoretByMc from haovdim 
group by machlaka
--4.6
alter table haovdim add vetek nvarchar(20);
update haovdim set vetek = 'vatikim' where tikishi < 150
update haovdim set vetek = 'benoni' where tikishi between 150 and 300
update haovdim set vetek = 'chadash' where tikishi > 300
select * from haovdim
--4.6.1
select  count(machlaka) as machlaka4Count from haovdim
where vetek = 'chadash' and machlaka = 4
--4.6.2
select max(maskoret) as "maxMaskoret" from haovdim
where vetek = 'benoni'
--4.6.3
select vetek, avg(maskoret) as avgByVetek from haovdim group by vetek
having avg(maskoret) > 10000
--4.6.4
select vetek, max(maskoret) as bigMaskoret from haovdim group by vetek
--5.1
create table menahalim
(
siduri int identity(1,1) primary key,
menahelshem nvarchar(20),
menahelmishp nvarchar(20),
menahelmachlaka int
);
insert into menahalim values
('jhonny', 'cash',  1), 
('manny', 'mamtera',  2), 
('michal', 'haktana',  3),
('hakuna', 'matata',  4)

select*from menahalim

--5.2.1
select menahalim.shem
from haovdim,menahalim
where menahalim.machlaka=haovdim.machlaka
and haovdim.prati='Rut'
and haovdim.mishpacha='Backer'

--5.2.2

select max(maskoret) from haovdim

select menahalim.shem
from haovdim,menahalim
where menahalim.machlaka=haovdim.machlaka 
and maskoret=19865

--5.2.3
select menahalim.shem,prati
from haovdim,menahalim
where menahalim.machlaka=haovdim.machlaka
and tikishi>50 and tikishi<200
-- 5.3
--drop table hovot
create table hovot
(
siduri int identity(1,1) primary key,
misparoved int,
chov int 
);

insert into hovot values
(49, 2000),
(33, 19000),
(17, 21500),
(117, 2000),
(49, 5000),
(91, 28900),
(53, 12000),
(3, 5300),
(93, 3000),
(122, 7777);

select * from hovot


-- 5.4
select menahelshem, chov 
from haovdim, menahalim, hovot
where menahalim.siduri = haovdim.machlaka and hovot.misparoved = haovdim.siduri


-- 5.5
select menahelshem, count(chov) as Misparhalvatot, sum(chov) as SchumKolel 
from haovdim, menahalim, hovot
where menahalim.siduri = haovdim.machlaka 
and hovot.misparoved = haovdim.siduri
group by menahelshem


-- 6.1
alter table hovot add check (chov<30000)
--insert into hovot values (149, 30001)


-- 6.2
select * from hovot
alter table hovot
add foreign key (misparoved) references haovdim(siduri);
-- 6.3A

insert into hovot values
(501, 2000);
-- 6.3B

delete from haovdim where siduri = 49
-- 6.3C
delete from hovot where misparoved = 49
delete from haovdim where siduri = 49

---7.1
select * from haovdim 
where tikishi<
(select top 1 tikishi from haovdim where maskoret > 17285 order by  tikishi
--7.2
select * from haovdim 
where maskoret <
(select avg(maskoret) from haovdim)
order by maskoret 
--7.3
select * from haovdim
where maskoret >=
(select avg(maskoret)+4000 from haovdim)
--7.4
select * from haovdim
where machlaka = 4
and maskoret > (select max(maskoret) from haovdim where machlaka =3)

select * from haovdim
where machlaka = 4
and maskoret > all (select max(maskoret) from haovdim where machlaka =3)
--7.5
select * from haovdim
where machlaka = 4
and maskoret > (select min(maskoret) from haovdim where machlaka =3)

select * from haovdim
where machlaka = 4
and maskoret > any (select min(maskoret) from haovdim where machlaka =3)

--7.6.1
select * from haovdim where leda > 
all (select leda from haovdim where prati like 'G%')
--7.6.2
select * from haovdim where leda > 
any (select leda from haovdim where prati like 'G%')

-- 7.7
select top 2 machlaka  from haovdim group by machlaka order by count(*) 

-- 7.8
select prati from haovdim where prati in
(select prati from haovdim where machlaka = 1) and machlaka <> 1

-- select prati, machlaka from haovdim order by prati

-- 7.9
select * from menahalim where exists (select * from hovot where chov > 28000)

-- 7.10
drop table menahalim2
create table menahalim2
(
siduri int identity(1,1) primary key,
menahelshem nvarchar(20),
menahelmishp nvarchar(20),
menahelmachlaka int
);

insert into menahalim2
select distinct menahelshem, menahelmishp, menahelmachlaka
from haovdim, menahalim
	where menahalim.menahelmachlaka = haovdim.machlaka
	and maskoret < 9000
select * from menahalim2


drop table taarichim
create table taarichim
(
siduri int identity(1,1) primary key,
mispar int,
taken date,
givenback date
);


insert into taarichim values
(252, '2018-2-12', '2018-11-28'),
(2321, '2018-10-17', '2018-11-18'),
(1821, '2018-9-17', '2018-12-18'),
(161, '2018-6-17', '2018-12-18'),
(126, '2018-2-17', '2018-2-18'),
(325, '2018-11-17', '2018-12-18'),
(25, '2015-12-31', '2016-1-1')
;
----9.1----
select * from haovdim order by leda
select top 5* from haovdim order by leda DESC
-----9.2------
select *, DATEDIFF(day,leda,CURRENT_TIMESTAMP)from haovdim
where prati = 'shelly' and  mishpacha='Gartner'
select*, datediff(day,leda,(CURRENT_TIMESTAMP))+15*365 from haovdim
where prati = 'shelly' and  mishpacha='Gartner'
-----9.3-----
select*from haovdim order by month(leda)
-----9.4-----
select * from haovdim where datediff(year,leda,CURRENT_TIMESTAMP)>42 
-----9.5-----
select day(leda), DATENAME(month, leda)  from haovdim 
order by DATEPART(month, leda), DATEPART(day, leda)
-----10.1------
select * from haovdim where datediff(year,leda,CURRENT_TIMESTAMP)<=40
and machlaka = 3 and maskoret > 16000
-----10.2------
declare @memutza float
 set @memutza =  (select avg(maskoret)*1.25 from haovdim) 
select @memutza  
select * from haovdim
where maskoret > @memutza
-----10.3------
--drop procedure haalaa 
create procedure haalaa @achuz int
as
begin
	select AVG(maskoret + maskoret*@achuz/100) from haovdim
end

exec haalaa @achuz = 0
exec haalaa @achuz = 2
exec haalaa @achuz = 5
exec haalaa @achuz = 10
-- 10.4
declare @tosefetraz int
set @tosefetraz = 1
while @tosefetraz < 10
begin
  exec haalaa @achuz = @tosefetraz
  set @tosefetraz = @tosefetraz + 1
end


-- 10.5
create proc haalaaWthPelet @achuz int, @sachar float output
as
begin
set @sachar = 
	(select AVG(maskoret + maskoret*@achuz/100) from haovdim)
end

declare @tosefetraz1 int
set @tosefetraz1 = 1
while @tosefetraz1 < 10
begin
	declare @memuzaachshav float
	exec haalaaWthPelet @tosefetraz1, @memuzaachshav output
if @memuzaachshav > 13000 
	break
set @tosefetraz1 = @tosefetraz1 + 1
end
select @tosefetraz1 



-- 10.6
-- alter table haovdim drop column longdoal
alter table haovdim add longdoal nvarchar(10)
go
update haovdim set longdoal = 
case 
	when LEN(doal)> 20 then 'aroch'
	when LEN (doal) > 15 then 'benoni'
	else 'kazar'
	end
select * from haovdim
-----11.1----
drop table tiul
create table tiul
(

siduri int identity(1,1) primary key, 
heshtatfut nvarchar(50),
);
insert into tiul values
('loba'),
('baLevad'),
('baLevad lo ochel'),
('ba im benzug lelo arucha'),
('ba im benzug veim arucha')
select*from tiul
------11.2-----
alter table haovdim add tiyul int

update haovdim set tiul = floor(RAND(CAST(NEWID()AS VARBINARY))*5)+1
select * from haovdim
-------11.3-----
drop view kamabaim

CREATE VIEW kamabaim AS
SELECT prati,mishpacha,siduri, tiyul
FROM haovdim ,tiul
WHERE siduri =tiyul

select*from kamabaim

-------11.4-------














CREATE TABLE student (
   siduri int identity(1,1) primary key,
  shem nvarchar (10),
  zioynim int
)
insert into students values
('avi', 60),
('moshe', 90),
('yaniv' ,70),
('yakov',65),
('tal',98),
('haim',100),
('matan',99)
select * from students 

create procedure laalot @raise int
as
begin

begin tran
update ziyonim set tsion +@raise where tsiun < 70
declare @grades int

if @grades >100
rollback tran
select('doing rollback..')
end
drop procedure laalot
select * from student
exec laalot @raise=30
exec laalot @grades = tsion








